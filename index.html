<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XenzChat - Video + Voice + Text</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100vh;
        margin: 0;
    }
    h1 { margin: 10px 0; }
    #videoContainer {
        display: flex;
        gap: 10px;
        margin: 10px;
    }
    video {
        width: 300px;
        height: 225px;
        background: black;
        border-radius: 8px;
        border: 2px solid #444;
    }
    #chat {
        flex: 1;
        overflow-y: auto;
        width: 90%;
        max-width: 600px;
        margin: 10px;
        border: 1px solid #444;
        padding: 10px;
        background: #1c1c1c;
        border-radius: 8px;
    }
    .msg { margin: 5px 0; }
    .user { color: #4ade80; }
    .ai { color: #60a5fa; }
    #controls {
        display: flex;
        width: 90%;
        max-width: 600px;
        margin-bottom: 10px;
    }
    input {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 5px 0 0 5px;
        outline: none;
    }
    button {
        padding: 10px;
        border: none;
        cursor: pointer;
    }
    #sendBtn {
        background: #4ade80;
        border-radius: 0 5px 5px 0;
    }
    #voiceBtn {
        margin-left: 5px;
        border-radius: 5px;
        background: #facc15;
    }
    #videoBtn {
        margin-left: 5px;
        border-radius: 5px;
        background: #3b82f6;
        color: white;
    }
</style>
</head>
<body>
<h1>XenzChat</h1>

<!-- Video area -->
<div id="videoContainer">
    <video id="userVideo" autoplay muted></video>
</div>

<!-- Chat area -->
<div id="chat"></div>

<!-- Controls -->
<div id="controls">
    <input type="text" id="userInput" placeholder="Type your message...">
    <button id="sendBtn">Send</button>
    <button id="voiceBtn">ðŸŽ¤</button>
    <button id="videoBtn">ðŸ“¹</button>
</div>

<!-- Load PuterJS -->
<script src="https://js.puter.com/v1/"></script>
<script>
const chatBox = document.getElementById('chat');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const voiceBtn = document.getElementById('voiceBtn');
const videoBtn = document.getElementById('videoBtn');
const userVideo = document.getElementById('userVideo');

let xenzAI = null; // AI instance
let conversation = JSON.parse(localStorage.getItem("chatHistory") || "[]");

if (conversation.length === 0) {
    conversation.push({
        role: "system",
        content: "You are XenzChat, a helpful, friendly, and knowledgeable AI assistant. " +
                 "Never refer to yourself as ChatGPT or any other AI â€” only XenzChat."
    });
}

// Load previous messages
conversation.forEach(msg => {
    if (msg.role !== "system") addMessage(msg.content, msg.role);
});

function addMessage(text, sender) {
    const div = document.createElement('div');
    div.classList.add('msg', sender);
    div.textContent = `${sender === 'user' ? 'You' : 'XenzChat'}: ${text}`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function saveConversation() {
    localStorage.setItem("chatHistory", JSON.stringify(conversation));
}

async function sendMessage(message) {
    if (!message.trim()) return;
    addMessage(message, 'user');
    conversation.push({ role: 'user', content: message });
    saveConversation();
    userInput.value = '';

    try {
        if (!xenzAI) {
            xenzAI = await puter.ai.create();
        }

        const reply = await xenzAI.chat({
            messages: conversation
        });

        addMessage(reply, 'ai');
        conversation.push({ role: 'assistant', content: reply });
        saveConversation();

        const utterance = new SpeechSynthesisUtterance(reply);
        speechSynthesis.speak(utterance);

    } catch (err) {
        addMessage("Error: " + err.message, 'ai');
    }
}

sendBtn.onclick = () => sendMessage(userInput.value);
userInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') sendMessage(userInput.value);
});

// Voice recognition
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (SpeechRecognition) {
    const recognition = new SpeechRecognition();
    recognition.lang = 'en-US';
    recognition.interimResults = false;

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        sendMessage(transcript);
    };

    recognition.onerror = (event) => {
        addMessage("Voice error: " + event.error, 'ai');
    };

    voiceBtn.onclick = () => {
        recognition.start();
        addMessage("ðŸŽ¤ Listening...", 'ai');
    };
} else {
    voiceBtn.disabled = true;
    voiceBtn.textContent = "No Mic";
}

// Video start/stop
let videoStream = null;
videoBtn.onclick = async () => {
    if (!videoStream) {
        try {
            videoStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
            userVideo.srcObject = videoStream;
            videoBtn.textContent = "â¹";
        } catch (err) {
            addMessage("Video error: " + err.message, 'ai');
        }
    } else {
        let tracks = videoStream.getTracks();
        tracks.forEach(track => track.stop());
        userVideo.srcObject = null;
        videoStream = null;
        videoBtn.textContent = "ðŸ“¹";
    }
};
</script>
</body>
</html>
